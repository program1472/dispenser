# 루시드 포털 규칙

> 루시드(협력사) 포털의 탭 구조, 콘텐츠 등록/수정, 배분 정책

---

## 🎯 포털 개요

**역할**: 루시드는 협력사로서 콘텐츠를 제작·등록하고, 고객 수정 요청 건에 대해 배분을 받음

**디렉토리**: `doc/lucid/`

**메뉴 ID**: `L01`, `L02`, `L03` ...

**중요**: 정책(배분) 탭은 루시드 포털에서 미노출 (HQ 전용)

---

## 📑 탭 구조 및 기능

### 1. 대시보드 (dashboard.php)
**메뉴 ID**: L01

**주요 위젯**:
- 전월 완료 콘텐츠의 루시드 배분 예상액 요약
- 미처리/마감임박 알림 (정산/수정요청)
- 최근 등록/수정 10건 하이라이트
- 신규 30일 "NEW" 배지

---

### 2. 신규콘텐츠 등록 (content_new.php)
**메뉴 ID**: L02

**필수 항목**:
- 제목
- 설명
- 이미지(업로드)
- 태그(복수)
- 등록일

**기본가**: 0원 (루시드 포털 기준)

**유료 과금**: HQ 정책 기준으로 계산·표시

**등록 후**: 30일간 "NEW" 자동 배지

**프로세스**: HQ 승인 후 전 포털 반영

---

### 3. 수정요청 (edit_requests.php)
**메뉴 ID**: L03

**프로세스**:
```
고객 → HQ → 루시드(시안) → HQ → 고객 승인 → HQ 완료
```

**상태**:
- OPEN: 접수
- 보완요청: HQ에서 루시드로 보완 요청
- IN_PROGRESS: 루시드 작업 중
- DONE: 완료

**기능**:
- 상태 변경
- 타임라인 표시
- 담당자 지정
- 파일 업/다운로드
- CSV 내보내기

**배분 대상 판정**: "고객 수정 요청"이 있는 루시드 협업 콘텐츠만 대상

---

### 4. 라이브러리 (content_library.php)
**메뉴 ID**: L04

**표시 형식**: 썸네일/리스트 전환

**기능**:
- 검색/필터 (태그/상태/등록일)
- 신규 등록 30일 이내 "NEW" 배지
- 콘텐츠 상세 팝업: 이력, 태그, 수정요청 연결

---

### 5. 태그관리 (tag_mgmt.php)
**메뉴 ID**: L05

**기능**:
- 태그 생성/수정/삭제
- 그룹 관리
- 일괄 적용

**권한**: HQ도 태그 편집 가능 (동기화)

---

### 6. 정산 (settlement.php)
**메뉴 ID**: L06

**대상**: 전월 DONE 상태의 "루시드 협업 + 고객 수정요청" 콘텐츠

**지급상태**: PLANNED → DUE → PAID

**지급일**: 익월 15일 자동 계산

**기능**: CSV 다운로드 (월별/콘텐츠별/고객별)

---

## 💰 루시드 정책 및 배분 규칙

### 배분 조건
- 루시드 협업 배분 **기본 50%**
- **조건**: 고객이 수정 요청한 경우에만 배분
- 단순 프린트/복제 요청은 배분 제외

### 배분 계산식
```javascript
// 루시드 배분액
lucidShare = contentPrice * 0.5; // 기본 50%

// 정산 대상 필터
isEligible = (
  collaboration === true &&
  editRequest === true &&
  status === 'DONE' &&
  month === previousMonth
);
```

### 정책 관리
- 배분율(50%)은 HQ 정책센터에서 변경 가능
- 루시드 포털은 읽기 전용

### 콘텐츠 가격 참고 (표시용)
| 등급 | 가격 |
|------|------|
| Basic | 11,000원 |
| Standard | 22,000원 |
| Deluxe | 110,000원 |
| Premium | 220,000원 |

**참고**: 실제 과금·정산 기준은 `policy_appendix.txt`와 HQ 정책센터 값을 우선

---

## 🏷️ 상태/배지/알림 규칙

### 콘텐츠 배지
- **신규**: 등록 후 30일간 "NEW" 배지
- 계산식: `(오늘 - 등록일) ≤ 30일`

### 수정요청 상태 배지
- **OPEN**: 파랑
- **보완요청**: 보라
- **IN_PROGRESS**: 주황
- **DONE**: 초록

### 정산 상태 배지
- **PLANNED**: 회색
- **DUE**: 파랑
- **PAID**: 초록

### 마감 임박
- **D-3** 강조 (정산/수정요청 마감 기준)
- 계산식: `(마감일 - 오늘) ≤ 3일`

---

## 📐 자동 계산 공식

```javascript
// 1. 루시드 배분액
lucidShare = contentPrice * 0.50; // 기본값, 정책센터 변경 반영

// 2. 정산 대상
isSettlementTarget = (
  status === 'DONE' &&
  month === previousMonth &&
  isCollaboration === true &&
  hasEditRequest === true
);

// 3. 지급일 (정산월 + 1개월의 15일)
paymentDate = new Date(settlementMonth.getFullYear(), settlementMonth.getMonth() + 1, 15);

// 4. 신규 배지 표시
isNew = (today - registeredDate) <= 30 * 24 * 60 * 60 * 1000; // 30일

// 5. 마감 임박
daysLeft = Math.floor((deadline - today) / (1000 * 60 * 60 * 24));
isUrgent = daysLeft <= 3;
```

---

## 🔓 권한 및 접근

| 주체 | 권한 |
|------|------|
| 루시드 | 본인 등록 콘텐츠, 수정요청, 정산 내역 접근 |
| HQ | 전체 루시드 콘텐츠 및 태그 편집, 배분율 변경 |
| 벤더/고객/영업사원 | 루시드 포털 접근 불가 |

**정책 수정**: HQ 정책센터 전용
**로그 기록**: 모든 상태 변경/정산/태그 편집 자동 로그

---

## 🛠️ 개발 체크리스트

### 루시드 포털 개발 시
- [ ] 배분율 50% 정확히 적용
- [ ] 고객 수정 요청 건만 배분 대상
- [ ] 정산 지급일 자동 계산 (익월 15일)
- [ ] 신규 콘텐츠 30일간 "NEW" 배지
- [ ] 마감 임박 D-3 알림
- [ ] 본인 콘텐츠만 조회 (권한 체크)
- [ ] CSV 내보내기 모든 탭에 적용
- [ ] 더미데이터 20건 이상

### UI 특이사항
- [ ] HQ 매출은 숨김 (루시드 관련 매출/정산만 표시)
- [ ] 정책 탭 미노출 (HQ 전용)
- [ ] 상단 고정 사업장 필터 전 탭 동기화

---

**마지막 업데이트**: 2025-11-06 (v1.1)
