# 벤더 포털 규칙

> 벤더 포털의 탭 구조, 커미션/인센티브 정책, 작업지시서 규칙

---

## 🎯 포털 개요

**역할**: 벤더는 본사(HQ)의 파트너로서 고객에게 제품/서비스를 제공하고 커미션과 인센티브를 받음

**디렉토리**: `doc/vendor/`

**메뉴 ID**: `V01`, `V02`, `V03` ...

---

## 📑 탭 구조 및 기능

### 1. 대시보드 (dashboard.php)
**메뉴 ID**: V01

**주요 위젯**:
- 월별 실적 요약
  - 이번 달 총 매출
  - 예상 커미션 (매출 × 40%)
  - 예상 인센티브 (매출 × 5%)
  - 미처리 작업지시
- KPI 현황 (목표 대비 달성률 게이지)
- 알림 위젯
  - 마감 임박 작업지시 (D-3)
  - 미처리 티켓
  - 결제 대기 건수

**자동 계산**:
```javascript
예상 커미션 = 이번 달 유료 매출 × 0.40
예상 인센티브 = 이번 달 유료 매출 × 0.05
월 총 예상 수입 = 커미션 + 인센티브
```

---

### 2. 고객관리 (customer_mgmt.php)
**메뉴 ID**: V02

**표시 항목**:
- 고객명, 사업장
- 계약 상태 (ACTIVE / WARNING / TERMINATED)
- 구독 상태
- 잔여 기간
- 결제 상태
- 최근 작업일

**기능**:
- 고객별 상세보기 (계약 이력, 기기 현황, 주문 내역)
- HQ 연동 데이터 자동 로드
- CSV 내보내기

---

### 3. 작업지시서 (work_orders.php) — 조회 전용
**메뉴 ID**: V03

**표시 항목**:
- WO 번호
- 발행일
- 고객명
- 작업 유형 (설치/수리/점검/회수)
- 상태 (OPEN / IN_PROGRESS / DONE)
- 담당자
- 예정일/완료일

**권한**:
- **벤더는 조회만 가능**
- 상태 변경은 HQ 전용

**상태 흐름**:
```
OPEN → IN_PROGRESS → DONE
```

---

### 4. 결제 (billing.php)
**메뉴 ID**: V04

**표시 항목**:
- 결제일
- 고객명
- 항목 (구독료/콘텐츠/향/기타)
- 금액
- 결제 상태 (PLANNED / DUE / PAID)
- 결제 수단

**기능**:
- 결제 실패 시 알림
- CSV 내보내기

---

### 5. 정산 (settlement.php)
**메뉴 ID**: V05

**정산 항목**:
- **커미션**: 유료 매출 × 40%
- **인센티브**: 유료 매출 × 5%

**표시 항목**:
- 정산월
- 유료 매출액
- 커미션 금액
- 인센티브 금액
- 지급 상태 (PLANNED → DUE → PAID)
- 지급 예정일/완료일

**지급 정책**:
- 지급일: 익월 15일
- 정산 기준: 전월 1일~말일 완료된 결제 건

**예시 계산**:
```
전월 유료 매출: 10,000,000원
커미션 (40%): 4,000,000원
인센티브 (5%): 500,000원
총 지급액: 4,500,000원
지급일: 익월 15일
```

---

### 6. 신규상품 등록 (new_content.php)
**메뉴 ID**: V06

**등록 항목**:
- 상품명
- 카테고리 (향/콘텐츠/기기/기타)
- 설명
- 이미지 업로드
- 희망 단가
- 등록일

**프로세스**:
```
벤더 등록 → HQ 검토 → 승인/반려 → 전 포털 반영
```

**상태**:
- REQUESTED: 요청
- REVIEWED: 검토 중
- APPROVED: 승인
- REJECTED: 반려

---

### 7. 티켓 (tickets.php)
**메뉴 ID**: V07

**티켓 유형**:
- 고객 요청 (HQ에서 벤더로 전달)
- 벤더 문의 (벤더→HQ)

**표시 항목**:
- 티켓 번호
- 유형
- 제목
- 요청자/담당자
- 상태 (OPEN / IN_PROGRESS / RESOLVED)
- 등록일/처리일
- 우선순위

**기능**:
- 티켓 상세 (내용, 첨부파일, 답변 이력, 타임라인)
- 상태 변경 및 답변 등록
- CSV 내보내기

---

### 8. 상품구매 (product_purchase.php)
**메뉴 ID**: V08

**표시 항목**:
- 발주 번호
- 발주일
- 상품명
- 수량
- 금액
- 상태 (REQUESTED → CONFIRMED → SHIPPED → RECEIVED)
- 배송 예정일

**기능**:
- 발주 요청 등록
- 배송 상태 추적
- 입고 확인 처리

---

## 💰 커미션 및 인센티브 정책

### 커미션 계산
```php
$commission = $paidSales * 0.40; // 40%
```

**대상**: 유료 매출 (구독료, 유료 콘텐츠, 향 추가 구매 등)
**제외**: 무료 서비스, 프로모션, 할인 금액

### 인센티브 계산
```php
$incentive = $paidSales * 0.05; // 5%
```

**대상**: 유료 매출 전체
**조건**: 목표 달성 또는 특정 실적 기준 충족 시

### 자동 계산 공식

```javascript
// 1. 월 예상 커미션
commission = thisMonthPaidSales * 0.40;

// 2. 월 예상 인센티브
incentive = thisMonthPaidSales * 0.05;

// 3. 월 총 예상 수입
totalIncome = commission + incentive;

// 4. 목표 달성률
achievementRate = (thisMonthSales / targetSales) * 100;

// 5. 지급 예정일
paymentDate = new Date(settlementMonth.getFullYear(), settlementMonth.getMonth() + 1, 15);

// 6. 마감 임박 (D-3)
daysLeft = Math.floor((deadline - today) / (1000 * 60 * 60 * 24));
isUrgent = daysLeft <= 3;
```

---

## 📋 작업지시서(WO) 규칙

### 작업 유형
- **설치**: 신규 기기 설치
- **수리**: 기기 고장 수리
- **점검**: 정기 점검
- **회수**: 기기 회수

### 벤더 권한
- **조회**: 본인 담당 작업지시서만 조회
- **상태 변경**: 불가 (HQ 전용)
- **완료 보고**: 별도 프로세스 (티켓 또는 별도 보고 기능)

---

## 🏷️ 상태 배지

### 계약 상태
- **ACTIVE**: 초록
- **WARNING**: 노랑
- **TERMINATED**: 회색

### 작업지시
- **OPEN**: 파랑
- **IN_PROGRESS**: 주황
- **DONE**: 초록

### 결제/정산
- **PLANNED**: 회색
- **DUE**: 파랑
- **PAID**: 초록

### 티켓
- **OPEN**: 파랑
- **IN_PROGRESS**: 주황
- **RESOLVED**: 초록

---

## 🛠️ 개발 체크리스트

### 벤더 포털 개발 시
- [ ] 커미션 40%, 인센티브 5% 정확히 적용
- [ ] 작업지시서는 조회 전용 (상태 변경 불가)
- [ ] 정산 지급일 자동 계산 (익월 15일)
- [ ] 마감 임박 알림 (D-3)
- [ ] 본인 담당 고객만 조회 (권한 체크)
- [ ] CSV 내보내기 모든 탭에 적용
- [ ] 더미데이터 20건 이상

---

**마지막 업데이트**: 2025-11-06 (v1.1)
