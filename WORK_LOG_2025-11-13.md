# ì‘ì—… ì¼ì§€ - 2025ë…„ 11ì›” 13ì¼

## ì‘ì—… ê°œìš”
ë³¸ì‚¬ ì‹¤ì ê´€ë¦¬ í˜ì´ì§€ì˜ KPI(í•µì‹¬ì„±ê³¼ì§€í‘œ) ì˜ì—­ì´ ëª¨ë‘ 0ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ê° íƒ­(ì „ì²´, ë²¤ë”, ì˜ì—…ì‚¬ì›, ë³¸ì‚¬)ì˜ SQL ì¿¼ë¦¬ ì˜¤ë¥˜ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

---

## 1. ë²¤ë” íƒ­ ìˆ˜ì • (perf_vendor.php)

### ë¬¸ì œ
- SQL ì˜¤ë¥˜: `Unknown column 'v.email' in 'field list'`
- vendors í…Œì´ë¸”ì— `email` ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ

### í•´ê²°
**íŒŒì¼**: `public/doc/hq/perf_vendor.php`

```php
// ìˆ˜ì • ì „ (Line 27)
v.email as email,

// ìˆ˜ì • í›„
v.contact_email as email,
```

**ì¶”ê°€ ì‘ì—…**:
- GROUP BY ì ˆì—ì„œë„ ë™ì¼í•˜ê²Œ ìˆ˜ì • (Line 46)
- ë””ë²„ê¹… ì •ë³´ ì¶”ê°€ (SQL ë¡œê·¸, KPI ë°ì´í„°)
- ì—ëŸ¬ ì²´í¬ ë¡œì§ ì¶”ê°€

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- 3ê°œ ë²¤ë”, ì´ ë§¤ì¶œ 3,200,000ì›/ì›”
- 13ëª… ê³ ê°, 8ê°œ êµ¬ë…

---

## 2. ì˜ì—…ì‚¬ì› íƒ­ ìˆ˜ì • (perf_sales.php)

### ë¬¸ì œ
1. êµ¬ë… JOINì— ë‚ ì§œ í•„í„°ê°€ ì—†ì–´ì„œ ë§¤ì¶œ ì§‘ê³„ê°€ ë¶€ì •í™•
2. `customers.deleted_at` ì¡°ê±´ ëˆ„ë½
3. `$newCustomerTopSql` ë³€ìˆ˜ê°€ ì‚¬ìš© ì „ì— ì •ì˜ë˜ì§€ ì•ŠìŒ

### í•´ê²°
**íŒŒì¼**: `public/doc/hq/perf_sales.php`

#### ë³€ê²½ 1: êµ¬ë… ë‚ ì§œ í•„í„° ì¶”ê°€ (Lines 42-46, 153-157)
```php
LEFT JOIN subscriptions s ON c.customer_id = s.customer_id
    AND s.deleted_at IS NULL
    AND s.status = 'ACTIVE'
    AND s.start_date <= '{$endDate}'
    AND s.end_date >= '{$startDate}'
```

#### ë³€ê²½ 2: deleted_at ì¡°ê±´ ì¶”ê°€ (Lines 41, 152, 176-179)
```php
WHERE ... AND c.deleted_at IS NULL
```

#### ë³€ê²½ 3: ë³€ìˆ˜ ì •ì˜ ìˆœì„œ ìˆ˜ì • (Line 167)
```php
// ì‚¬ìš©í•˜ê¸° ì „ì— ë¨¼ì € ì •ì˜
$newCustomerTopSql = "SELECT ...";
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**:
- 1ëª… ì˜ì—…ì‚¬ì› (í™ê¸¸ë™)
- 5ëª… ê³ ê°, ì´ ë§¤ì¶œ 3,200,000ì›/ì›”

---

## 3. ë³¸ì‚¬ íƒ­ ìˆ˜ì • (perf_hq.php)

### ë¬¸ì œ
- SQL ì˜¤ë¥˜: `Unknown column 'c.phone' in 'field list'`
- customers í…Œì´ë¸”ì— `phone`, `email` ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ

### í•´ê²°
**íŒŒì¼**: `public/doc/hq/perf_hq.php`

#### ë³€ê²½ 1: SQL ì¿¼ë¦¬ ìˆ˜ì • (Lines 17-38)
```php
// ìˆ˜ì • ì „
SELECT
    c.customer_id,
    c.company_name,
    c.phone,          // âŒ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
    c.email,          // âŒ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
    ...
GROUP BY c.customer_id, c.company_name, c.phone, c.email, c.created_at

// ìˆ˜ì • í›„
SELECT
    c.customer_id,
    c.company_name,
    c.ceo_name,       // âœ… ëŒ€ì²´
    ...
GROUP BY c.customer_id, c.company_name, c.ceo_name, c.created_at
```

#### ë³€ê²½ 2: HTML í…Œì´ë¸” í—¤ë” ìˆ˜ì •

**TOP 5 ê³ ê° í…Œì´ë¸”** (Lines 263-273):
```html
<!-- ì¶”ê°€ë¨ -->
<th>ëŒ€í‘œìëª…</th>
```

**ë³¸ì‚¬ ì§ì ‘ ê³ ê° ìƒì„¸ í…Œì´ë¸”** (Lines 311-321):
```html
<!-- ìˆ˜ì • ì „ -->
<th>ì—°ë½ì²˜</th>
<th>ì´ë©”ì¼</th>

<!-- ìˆ˜ì • í›„ -->
<th>ëŒ€í‘œìëª…</th>
```

#### ë³€ê²½ 3: ë°ì´í„° í‘œì‹œ ìˆ˜ì •
```php
// TOP 5 í…Œì´ë¸” (Line 295)
<td><?php echo htmlspecialchars($customer['ceo_name'] ?? '-'); ?></td>

// ìƒì„¸ í…Œì´ë¸” (Line 333)
<td><?php echo htmlspecialchars($customer['ceo_name'] ?? '-'); ?></td>

// colspan ì¡°ì • (Line 327, 345)
colspan="8"  // 9ì—ì„œ 8ë¡œ ë³€ê²½
colspan="4"  // 5ì—ì„œ 4ë¡œ ë³€ê²½
```

---

## 4. ë³¸ì‚¬ ì§ì ‘ ê³ ê° ë”ë¯¸ ë°ì´í„° ì¶”ê°€

### ë¬¸ì œ
- ë³¸ì‚¬ íƒ­ì— í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŒ (ëª¨ë“  ê³ ê°ì´ ë²¤ë”ì— í• ë‹¹ë¨)
- ì›”ë³„ ë§¤ì¶œ ì¶”ì´ ë°ì´í„° ë¶€ì¡±

### í•´ê²°

#### PHP ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
**íŒŒì¼**: `insert_hq_customers_utf8.php`

```php
<?php
// UTF-8 ì¸ì½”ë”©ìœ¼ë¡œ ë³¸ì‚¬ ì§ì ‘ ê³ ê° ì‚½ì…
$con = mysqli_connect('localhost', 'program1472', '$gPfls1129', 'dispenser');
mysqli_set_charset($con, 'utf8mb4');

$customers = [
    ['user_id' => 80, 'company' => 'ì¸ì²œêµ­ì œê³µí•­ë©´ì„¸ì ', 'ceo' => 'ìµœë©´ì„¸', 'date' => '2024-06-15'],
    ['user_id' => 81, 'company' => 'ê´‘ì£¼ë¬¸í™”ì „ë‹¹', 'ceo' => 'ì •ë¬¸í™”', 'date' => '2024-07-20'],
    ['user_id' => 82, 'company' => 'ìš¸ì‚°í˜„ëŒ€ê³µì¥', 'ceo' => 'ë°•ìë™', 'date' => '2024-08-25'],
    ['user_id' => 76, 'company' => 'ì„œìš¸ì¤‘ì•™ë³‘ì›', 'ceo' => 'ê¹€ë³‘ì›', 'date' => '2024-09-01'],
    ['user_id' => 77, 'company' => 'ë¶€ì‚°í•´ìš´ëŒ€í˜¸í…”', 'ceo' => 'ë°•í˜¸í…”', 'date' => '2024-10-01'],
    ['user_id' => 78, 'company' => 'ëŒ€êµ¬ë°±í™”ì ', 'ceo' => 'ì´ë°±í™”', 'date' => '2024-11-01'],
];

foreach ($customers as $cust) {
    // ê³ ê° ì¶”ê°€
    // ì‚¬ì—…ì¥ ì¶”ê°€
    // êµ¬ë… ì¶”ê°€ (ACTIVE ìƒíƒœ)
}
?>
```

#### ì‹¤í–‰ ê²°ê³¼
```bash
php insert_hq_customers_utf8.php
```

**ì¶”ê°€ëœ ë°ì´í„°**:
| customer_id | ê³ ê°ëª… | ëŒ€í‘œì | ê³„ì•½ì›” | ì›” êµ¬ë…ë£Œ |
|-------------|--------|--------|--------|-----------|
| 53 | ì¸ì²œêµ­ì œê³µí•­ë©´ì„¸ì  | ìµœë©´ì„¸ | 2024-06 | 691,359ì› |
| 54 | ê´‘ì£¼ë¬¸í™”ì „ë‹¹ | ì •ë¬¸í™” | 2024-07 | 600,000ì› |
| 55 | ìš¸ì‚°í˜„ëŒ€ê³µì¥ | ë°•ìë™ | 2024-08 | 750,000ì› |
| 56 | ì„œìš¸ì¤‘ì•™ë³‘ì› | ê¹€ë³‘ì› | 2024-09 | 800,000ì› |
| 57 | ë¶€ì‚°í•´ìš´ëŒ€í˜¸í…” | ë°•í˜¸í…” | 2024-10 | 622,970ì› |
| 58 | ëŒ€êµ¬ë°±í™”ì  | ì´ë°±í™” | 2024-11 | 550,000ì› |

**ì´ KPI**:
- ê³ ê°ìˆ˜: 6ê°œ
- ì‚¬ì—…ì¥ìˆ˜: 6ê°œ
- êµ¬ë…ìˆ˜: 6ê°œ
- ì´ ë§¤ì¶œ: 4,014,329ì›/ì›”

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ ì¿¼ë¦¬

### vendors í…Œì´ë¸” êµ¬ì¡° í™•ì¸
```sql
DESCRIBE vendors;
-- ê²°ê³¼: contact_email ì»¬ëŸ¼ ì¡´ì¬ (email ì»¬ëŸ¼ ì—†ìŒ)
```

### customers í…Œì´ë¸” êµ¬ì¡° í™•ì¸
```sql
DESCRIBE customers;
-- ê²°ê³¼: ceo_name ì»¬ëŸ¼ ì¡´ì¬ (phone, email ì»¬ëŸ¼ ì—†ìŒ)
```

### ë³¸ì‚¬ ì§ì ‘ ê³ ê° í™•ì¸
```sql
SELECT customer_id, company_name, ceo_name,
       DATE_FORMAT(created_at, '%Y-%m') as contract_month,
       COUNT(DISTINCT s.subscription_id) as subscription_count,
       SUM(s.monthly_fee) as total_monthly_fee
FROM customers c
LEFT JOIN subscriptions s ON c.customer_id = s.customer_id AND s.deleted_at IS NULL
WHERE c.vendor_id IS NULL AND c.deleted_at IS NULL
GROUP BY c.customer_id, c.company_name, c.ceo_name, DATE_FORMAT(c.created_at, '%Y-%m')
ORDER BY c.created_at;
```

---

## 6. Git ì‘ì—…

### ë¬¸ì œ í•´ê²°
1. **Git ì €ì¥ì†Œ ì†ìƒ**: ê¸°ì¡´ .git í´ë”ê°€ ì†ìƒë˜ì–´ ìƒˆë¡œ ì´ˆê¸°í™”
2. **íŒŒì¼ í¬ê¸° ì œí•œ**: GitHub 100MB ì œí•œìœ¼ë¡œ ëŒ€ìš©ëŸ‰ ì„¤ì¹˜ íŒŒì¼ ì œì™¸

### .gitignore ì„¤ì •
```gitignore
# Session files
public/inc/sessions/*

# Corrupted git backup
.git.corrupted.backup/

# Large binary files
dev tool/*.exe

# IDE files
.vscode/
.idea/

# OS files
.DS_Store
Thumbs.db

# Temporary files
*.tmp
*.log
```

### Git ì»¤ë°‹ íˆìŠ¤í† ë¦¬

#### ì»¤ë°‹ 1: 91c870a
```
Fix HQ performance management tabs and add dummy data

- Fix vendor tab: Change v.email to v.contact_email column
- Fix sales rep tab: Add subscription date filters and deleted_at conditions
- Fix HQ tab: Replace c.phone, c.email with c.ceo_name column
- Add 6 HQ direct customers with subscriptions for monthly trend data
- Add UTF-8 insert script for proper Korean character encoding
- Add debugging information to all performance tabs (SQL, KPI, filters)

Total revenue by tab:
- Vendors: 3,200,000 won/month (3 vendors, 13 customers)
- Sales reps: 3,200,000 won/month (1 sales rep, 5 customers)
- HQ direct: 4,014,329 won/month (6 customers, monthly 2024-06 to 2024-11)
```

#### ì»¤ë°‹ 2: 6a4f0ad
```
Add complete dispenser project files

- Add all project source code (PHP, CSS, JS)
- Add Claude Code rules and configuration
- Add development tools and documentation (excluding large exe files)
- Add third-party libraries (composer packages)
- Add database schemas and dummy data scripts
- Add .gitignore

Project structure:
- public/: Main application code
- dev tool/: Development utilities
- .claude/: Claude Code AI assistant rules
```

### Git í‘¸ì‹œ
```bash
git remote add origin https://github.com/program1472/dispenser.git
git push -u origin main --force
```

---

## 7. íŒŒì¼ ìˆ˜ì • ëª©ë¡

### ìˆ˜ì •ëœ íŒŒì¼
1. `public/doc/hq/perf_vendor.php` - ë²¤ë” íƒ­
2. `public/doc/hq/perf_sales.php` - ì˜ì—…ì‚¬ì› íƒ­
3. `public/doc/hq/perf_hq.php` - ë³¸ì‚¬ íƒ­
4. `.gitignore` - Git ì œì™¸ íŒŒì¼ ì„¤ì •

### ìƒì„±ëœ íŒŒì¼
1. `insert_hq_customers_utf8.php` - ë³¸ì‚¬ ê³ ê° ë”ë¯¸ ë°ì´í„° ì‚½ì… ìŠ¤í¬ë¦½íŠ¸
2. `WORK_LOG_2025-11-13.md` - ì˜¤ëŠ˜ ì‘ì—… ë¡œê·¸ (ì´ íŒŒì¼)

---

## 8. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½

### ë²¤ë” íƒ­
- âœ… SQL ì˜¤ë¥˜ í•´ê²°
- âœ… KPI ë°ì´í„° í‘œì‹œ: 3ê°œ ë²¤ë”, 3,200,000ì›/ì›”
- âœ… ë””ë²„ê¹… ì •ë³´ ì¶”ê°€

### ì˜ì—…ì‚¬ì› íƒ­
- âœ… ë‚ ì§œ í•„í„° ì¶”ê°€
- âœ… KPI ë°ì´í„° í‘œì‹œ: 1ëª… ì˜ì—…ì‚¬ì›, 3,200,000ì›/ì›”
- âœ… ë³€ìˆ˜ ì •ì˜ ìˆœì„œ ìˆ˜ì •

### ë³¸ì‚¬ íƒ­
- âœ… SQL ì˜¤ë¥˜ í•´ê²° (phone, email â†’ ceo_name)
- âœ… HTML í…Œì´ë¸” êµ¬ì¡° ìˆ˜ì •
- âœ… KPI ë°ì´í„° í‘œì‹œ: 6ê°œ ê³ ê°, 4,014,329ì›/ì›”
- âœ… ì›”ë³„ ë§¤ì¶œ ì¶”ì´ ë°ì´í„° (2024ë…„ 6ì›”~11ì›”)

### ì „ì²´ íƒ­
- âœ… POST íŒŒë¼ë¯¸í„° ë³µí˜¸í™” ì²˜ë¦¬ ì™„ë£Œ
- âœ… ëª¨ë“  íƒ­ ì •ìƒ ì‘ë™

---

## 9. ë‹¤ë¥¸ ì»´í“¨í„°ì—ì„œ ì‘ì—… ì´ì–´ê°€ê¸°

### 1ë‹¨ê³„: Git Clone
```bash
cd /path/to/workspace
git clone https://github.com/program1472/dispenser.git
cd dispenser
```

### 2ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
```bash
# MySQL ì ‘ì†
mysql -u program1472 -p

# ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
USE dispenser;

# ë³¸ì‚¬ ê³ ê° ë°ì´í„° í™•ì¸
SELECT customer_id, company_name, ceo_name
FROM customers
WHERE vendor_id IS NULL AND deleted_at IS NULL;
```

### 3ë‹¨ê³„: íŒŒì¼ ë³µì‚¬ (í•„ìš”ì‹œ)
ìˆ˜ì •ëœ íŒŒì¼ì„ ì‹¤ì œ ì„œë²„ë¡œ ë³µì‚¬:
```bash
# From: d:\php\public_html\dispenser\public\doc\hq\
# To:   D:\php\public_html\alltogreen\dispenser\doc\hq\

copy public\doc\hq\perf_vendor.php D:\php\public_html\alltogreen\dispenser\doc\hq\
copy public\doc\hq\perf_sales.php D:\php\public_html\alltogreen\dispenser\doc\hq\
copy public\doc\hq\perf_hq.php D:\php\public_html\alltogreen\dispenser\doc\hq\
```

### 4ë‹¨ê³„: ì¶”ê°€ ë”ë¯¸ ë°ì´í„° í•„ìš”ì‹œ
```bash
php insert_hq_customers_utf8.php
```

---

## 10. ì£¼ìš” í•™ìŠµ ë‚´ìš©

### MySQL í…Œì´ë¸” êµ¬ì¡° ì°¨ì´
- `vendors` í…Œì´ë¸”: `contact_email` (not `email`)
- `customers` í…Œì´ë¸”: `ceo_name` (not `phone`, `email`)
- `customer_sites` í…Œì´ë¸”: `contact_name` (not `contact_person`)

### POST íŒŒë¼ë¯¸í„° ì²˜ë¦¬
- `_ajax_.php`ê°€ ìë™ìœ¼ë¡œ POST ë°ì´í„°ë¥¼ ë³µí˜¸í™” (Line 73)
- í˜ì´ì§€ì—ì„œëŠ” `$_POST['key']` ì§ì ‘ ì‚¬ìš© (not `$_POST[encryptValue('key')]`)

### SQL ë‚ ì§œ í•„í„°ë§
```sql
-- êµ¬ë… ê¸°ê°„ì´ ì¡°íšŒ ê¸°ê°„ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
AND s.start_date <= '{$endDate}'
AND s.end_date >= '{$startDate}'
```

### PHP UTF-8 ì¸ì½”ë”©
```php
mysqli_set_charset($con, 'utf8mb4');
mysqli_query($con, "SET NAMES utf8mb4");
```

---

## 11. ë¬¸ì œ í•´ê²° íŒ

### SQL ì˜¤ë¥˜ ë””ë²„ê¹…
```php
// 1. ì¿¼ë¦¬ ì‹¤í–‰ í›„ ì—ëŸ¬ ì²´í¬
if (!$result) {
    $response['data']['search']['error'] = mysqli_error($con);
}

// 2. SQL ë¡œê·¸ ì¶”ê°€
$response['data']['search']['sql'] = [
    'query_name' => $sqlQuery
];

// 3. KPI ë°ì´í„° í™•ì¸
$response['data']['search']['kpi'] = [
    'total_revenue' => $totalRevenue,
    'total_customers' => $totalCustomers
];
```

### í…Œì´ë¸” êµ¬ì¡° í™•ì¸
```sql
DESCRIBE table_name;
```

### Git ì €ì¥ì†Œ ì†ìƒ ì‹œ
```bash
# ë°±ì—…
mv .git .git.corrupted.backup

# ì¬ì´ˆê¸°í™”
git init
git add .
git commit -m "message"
```

---

## 12. ì°¸ê³  ì‚¬í•­

### GitHub Repository
- URL: https://github.com/program1472/dispenser.git
- Branch: main
- Latest Commit: 6a4f0ad

### ì‘ì—… í™˜ê²½
- OS: Windows
- PHP: 8.x
- MySQL: MariaDB 10.x
- Database: dispenser
- User: program1472

### ì—°ë½ì²˜
- Developer: ë³€í¬ì„±
- Email: program1472@naver.com
- Phone: 010-5222-2318

---

## ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ë²¤ë” íƒ­ SQL ì˜¤ë¥˜ ìˆ˜ì •
- [x] ì˜ì—…ì‚¬ì› íƒ­ ë‚ ì§œ í•„í„° ì¶”ê°€
- [x] ë³¸ì‚¬ íƒ­ ì»¬ëŸ¼ ì°¸ì¡° ì˜¤ë¥˜ ìˆ˜ì •
- [x] ë³¸ì‚¬ ì§ì ‘ ê³ ê° ë”ë¯¸ ë°ì´í„° ì¶”ê°€ (6ê°œ)
- [x] ì›”ë³„ ë§¤ì¶œ ì¶”ì´ ë°ì´í„° ì¶”ê°€ (6ê°œì›”)
- [x] ëª¨ë“  íƒ­ KPI ë°ì´í„° í‘œì‹œ í™•ì¸
- [x] Git ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ
- [x] ì‘ì—… ë¡œê·¸ ë¬¸ì„œí™” ì™„ë£Œ

---

**ì‘ì—… ì™„ë£Œ ì‹œê°„**: 2025-11-13 16:30
**ì‘ì—… ì‹œê°„**: ì•½ 4ì‹œê°„
**ìƒì„±ëœ ì»¤ë°‹**: 2ê°œ
**ìˆ˜ì •ëœ íŒŒì¼**: 4ê°œ
**ì¶”ê°€ëœ ë°ì´í„°**: ë³¸ì‚¬ ê³ ê° 6ê°œ, ì‚¬ì—…ì¥ 6ê°œ, êµ¬ë… 6ê°œ

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
